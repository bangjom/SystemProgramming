# SystemProgramming

- ControlSection 방식의 SIC/XE 소스를 Object Program Code로 바꾸는 어셈블러 만들기
- SIC/XE 소스를 라인별로 처리해서 Object Code로 바꾼 후, Object Program Code로 변환하는 프로그램 

input

    COPY	START	0		COPY FILE FROM IN TO OUTPUT
		EXTDEF	BUFFER,BUFEND,LENGTH
		EXTREF	RDREC,WRREC
    FIRST	STL	RETADR		SAVE RETURN ADDRESS	
    CLOOP    +JSUB	RDREC		READ INPUT RECORD
		LDA	LENGTH		TEST FOR EOF (LENGTH = 0)
		COMP   #0		
		JEQ	ENDFIL	 	EXIT IF EOF FOUND
	  +JSUB	WRREC		WRITE OUTPUT RECORD
		J	CLOOP		LOOP
    ENDFIL 	LDA    =C'EOF'      	INSERT END OF FILE MARKER
    STA	BUFFER         
    LDA    #3		SET LENGTH = 3
    STA	LENGTH
    +JSUB	WRREC		WRITE EOF
    J       @RETADR	        	RETURN TO CALLER
    RETADR	RESW	1		
    LENGTH	RESW	1		LENGTH OF RECORD
		LTORG
    BUFFER	RESB	4096		4096-BYTE BUFFER AREA
    BUFEND	EQU	*
    MAXLEN	EQU	BUFEND-BUFFER	MAXIMUM RECORD LENGTH

    RDREC	CSECT
.
.   SUBROUTINE TO READ RECORD INTO BUFFER
.	
		EXTREF	BUFFER,LENGTH,BUFEND
		CLEAR	X		CLEAR LOOP COUNTER
		CLEAR	A		CLEAR A TO ZERO
		CLEAR	S		CLEAR S TO ZERO
    		LDT  	MAXLEN 
       RLOOP	TD	INPUT		TEST INPUT DEVICE
		JEQ	RLOOP		LOOP UNTIL READY
		RD	INPUT		READ CHARACTER INTO REGISTER A
		COMPR	A,S		TEST FOR END OF RECORD (X'00')
		JEQ	EXIT		EXIT LOOP IF EOR
	         +STCH	BUFFER,X	STORE CHARACTER IN BUFFER
		TIXR	T		LOOP UNLESS MAX LENGTH
		JLT	RLOOP		HAS BEEN REACHED
       EXIT     +STX	LENGTH		SAVE RECORD LENGTH
	  	RSUB			RETURN TO CALLER
       INPUT	BYTE	X'F1'		CODE FOR INPUT DEVICE
       MAXLEN	WORD	BUFEND-BUFFER	

       WRREC	CSECT
.
.      SUBROUTINE TO WRITE RECORD FROM BUFFER
.
		EXTREF	LENGTH,BUFFER
		CLEAR	X		CLEAR LOOP COUNTER
   	+LDT	LENGTH
    WLOOP	TD     =X'05' 		TEST OUTPUT DEVICE
		JEQ	WLOOP		LOOP UNTIL READY
   	+LDCH	BUFFER,X	GET CHARACTER FROM BUFFER
		WD     =X'05' 		WRITE CHARACTER
		TIXR	T		LOOP UNTIL ALL CHARACTERS
		JLT	WLOOP		HAVE BEEN WRITTEN
		RSUB			RETURN TO CALLER
		END	FIRST
    
    
    Output(in file)
    
    HCOPY	000000001033
    DBUFFER000033BUFEND001033LENGTH00002D
    RRDREC WRREC
    T0000001D1720274B1000000320232900003320074B1000003F2FEC0320160F2016
    T00001D0D0100030F200A4B1000003E2000
    T00003003454F46
    M00000405+RDREC
    M00001105+WRREC
    M00002405+WRREC
    E000000

    HRDREC	00000000002B
    RBUFFERLENGTHBUFEND
    T0000001DB410B400B44077201FE3201B332FFADB2015A00433200957900000B850
    T00001D0E3B2FE9131000004F0000F1000000
    M00001805+BUFFER
    M00002105+LENGTH
    M00002806+BUFEND
    M00002806-BUFFER
    E

    HWRREC	00000000001C
    RLENGTHBUFFER
    T0000001CB41077100000E32012332FFA53900000DF2008B8503B2FEE4F000005
    M00000305+LENGTH
    M00000D05+BUFFER
    E
    
    
    
    
